server {
    listen [::]:80;

    server_name ~^(?P<ext_domain>.*).(?P<ext_port>[0-9]+).pext.cditv.cn$;

    location / {
        resolver 223.5.5.5 ipv6=off;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Accept-Encoding "";
        proxy_redirect ~^http://([^/]*)/(.*)$ http://$1.ext.cditv.cn/$2;
        proxy_set_header Host $ext_domain;
        proxy_pass http://$ext_domain:$ext_port/$request_uri;

        sub_filter_last_modified on;
        sub_filter_once off;
        sub_filter_types text/css text/javascript application/javascript; #text/html is always included
        sub_filter '182.148.112.25:8080' '182.148.112.25.8080.pext.cditv.cn';
        sub_filter '218.89.164.17:7980' '218.89.164.17.7980.pext.cditv.cn';
        sub_filter '222.211.87.210:8080' '222.211.87.210.8080.pext.cditv.cn';
        sub_filter 'abbao.cn' 'abbao.cn.ext.cditv.cn';
        sub_filter 'adobe.com' 'adobe.com.ext.cditv.cn';
        sub_filter 'adomas.org' 'adomas.org.ext.cditv.cn';
        sub_filter 'alicdn.com' 'alicdn.com.ext.cditv.cn';
        sub_filter 'apache.org' 'apache.org.ext.cditv.cn';
        sub_filter 'apple.com' 'apple.com.ext.cditv.cn';
        sub_filter 'areaaperta.com' 'areaaperta.com.ext.cditv.cn';
        sub_filter 'baidu.com' 'baidu.com.ext.cditv.cn';
        sub_filter 'bootcss.com' 'bootcss.com.ext.cditv.cn';
        sub_filter 'bzgd.com' 'bzgd.com.ext.cditv.cn';
        sub_filter 'cctvpic.com' 'cctvpic.com.ext.cditv.cn';
        sub_filter 'cdcaa.net' 'cdcaa.net.ext.cditv.cn';
        sub_filter 'cdcaf.com' 'cdcaf.com.ext.cditv.cn';
        sub_filter 'cdcdw.org' 'cdcdw.org.ext.cditv.cn';
        sub_filter 'cddzgj.com:8189' 'cddzgj.com.8189.pext.cditv.cn';
        sub_filter 'cdhxzx.cn' 'cdhxzx.cn.ext.cditv.cn';
        sub_filter 'cdich.org' 'cdich.org.ext.cditv.cn';
        sub_filter 'cdimae.com' 'cdimae.com.ext.cditv.cn';
        sub_filter 'cdmetro.cn' 'cdmetro.cn.ext.cditv.cn';
        sub_filter 'cdsmes.com:8081' 'cdsmes.com.8081.pext.cditv.cn';
        sub_filter 'cdtv.cn' 'cdtv.cn.ext.cditv.cn';
        sub_filter 'cdtzjc.com' 'cdtzjc.com.ext.cditv.cn';
        sub_filter 'cdvolunteer.com' 'cdvolunteer.com.ext.cditv.cn';
        sub_filter 'cdzk.com' 'cdzk.com.ext.cditv.cn';
        sub_filter 'cdzk.net' 'cdzk.net.ext.cditv.cn';
        sub_filter 'cdzk.org' 'cdzk.org.ext.cditv.cn';
        sub_filter 'ce.cn' 'ce.cn.ext.cditv.cn';
        sub_filter 'ceweekly.cn' 'ceweekly.cn.ext.cditv.cn';
        sub_filter 'chengdu.cn' 'chengdu.cn.ext.cditv.cn';
        sub_filter 'chengdutv.com' 'chengdutv.com.ext.cditv.cn';
        sub_filter 'china.cn' 'china.cn.ext.cditv.cn';
        sub_filter 'chinanews.com' 'chinanews.com.ext.cditv.cn';
        sub_filter 'ciavc.com' 'ciavc.com.ext.cditv.cn';
        sub_filter 'cjn.cn' 'cjn.cn.ext.cditv.cn';
        sub_filter 'cntv.cn' 'cntv.cn.ext.cditv.cn';
        sub_filter 'com.cn' 'com.cn.ext.cditv.cn';
        sub_filter 'co.uk' 'co.uk.ext.cditv.cn';
        sub_filter 'cqcb.com' 'cqcb.com.ext.cditv.cn';
        sub_filter 'cqtimes.cn' 'cqtimes.cn.ext.cditv.cn';
        sub_filter 'creativecommons.org' 'creativecommons.org.ext.cditv.cn';
        sub_filter 'cri.cn' 'cri.cn.ext.cditv.cn';
        sub_filter 'csjmpd.com' 'csjmpd.com.ext.cditv.cn';
        sub_filter 'cssglobe.com' 'cssglobe.com.ext.cditv.cn';
        sub_filter 'cubiq.org' 'cubiq.org.ext.cditv.cn';
        sub_filter 'cyol.com' 'cyol.com.ext.cditv.cn';
        sub_filter 'dahe.cn' 'dahe.cn.ext.cditv.cn';
        sub_filter 'damai.cn' 'damai.cn.ext.cditv.cn';
        sub_filter 'dayoo.com' 'dayoo.com.ext.cditv.cn';
        sub_filter 'derraab.com' 'derraab.com.ext.cditv.cn';
        sub_filter 'douban.com' 'douban.com.ext.cditv.cn';
        sub_filter 'edu.cn' 'edu.cn.ext.cditv.cn';
        sub_filter 'edufair.org' 'edufair.org.ext.cditv.cn';
        sub_filter 'eqxiu.com' 'eqxiu.com.ext.cditv.cn';
        sub_filter 'europa.eu' 'europa.eu.ext.cditv.cn';
        sub_filter 'game.com' 'game.com.ext.cditv.cn';
        sub_filter 'gblock.cn' 'gblock.cn.ext.cditv.cn';
        sub_filter 'github.com' 'github.com.ext.cditv.cn';
        sub_filter 'gmgc.info' 'gmgc.info.ext.cditv.cn';
        sub_filter 'gmgdc.com' 'gmgdc.com.ext.cditv.cn';
        sub_filter 'gnu.org' 'gnu.org.ext.cditv.cn';
        sub_filter 'google.cn' 'google.cn.ext.cditv.cn';
        sub_filter 'google.com' 'google.com.ext.cditv.cn';
        sub_filter 'gov.cn' 'gov.cn.ext.cditv.cn';
        sub_filter 'gov.cn:9080' 'gov.cn.9080.pext.cditv.cn';
        sub_filter 'gov.il' 'gov.il.ext.cditv.cn';
        sub_filter 'gridsum.com' 'gridsum.com.ext.cditv.cn';
        sub_filter 'gridsumdissector.cn' 'gridsumdissector.cn.ext.cditv.cn';
        sub_filter 'gridsumdissector.com' 'gridsumdissector.com.ext.cditv.cn';
        sub_filter 'hsw.cn' 'hsw.cn.ext.cditv.cn';
        sub_filter 'huanqiu.com' 'huanqiu.com.ext.cditv.cn';
        sub_filter 'huatu.com' 'huatu.com.ext.cditv.cn';
        sub_filter 'hurun.net' 'hurun.net.ext.cditv.cn';
        sub_filter 'hxsc.org' 'hxsc.org.ext.cditv.cn';
        sub_filter 'idangero.us' 'idangero.us.ext.cditv.cn';
        sub_filter 'ifeng.com' 'ifeng.com.ext.cditv.cn';
        sub_filter 'ifengimg.com' 'ifengimg.com.ext.cditv.cn';
        sub_filter 'indiegamr.com' 'indiegamr.com.ext.cditv.cn';
        sub_filter 'jd.com' 'jd.com.ext.cditv.cn';
        sub_filter 'jfdaily.com' 'jfdaily.com.ext.cditv.cn';
        sub_filter 'jiblock.cn' 'jiblock.cn.ext.cditv.cn';
        sub_filter 'jinbaonet.com' 'jinbaonet.com.ext.cditv.cn';
        sub_filter 'jinghua.cn' 'jinghua.cn.ext.cditv.cn';
        sub_filter 'jquery.com' 'jquery.com.ext.cditv.cn';
        sub_filter 'jquery.org' 'jquery.org.ext.cditv.cn';
        sub_filter 'letv.com' 'letv.com.ext.cditv.cn';
        sub_filter 'lfnrtv.com' 'lfnrtv.com.ext.cditv.cn';
        sub_filter 'libo.ml' 'libo.ml.ext.cditv.cn';
        sub_filter 'lokeshdhakar.com' 'lokeshdhakar.com.ext.cditv.cn';
        sub_filter 'macromedia.com' 'macromedia.com.ext.cditv.cn';
        sub_filter 'mil.cn' 'mil.cn.ext.cditv.cn';
        sub_filter 'mozilla.org' 'mozilla.org.ext.cditv.cn';
        sub_filter 'mtime.com' 'mtime.com.ext.cditv.cn';
        sub_filter 'nandu.com' 'nandu.com.ext.cditv.cn';
        sub_filter 'ncss.cn' 'ncss.cn.ext.cditv.cn';
        sub_filter 'news.cn' 'news.cn.ext.cditv.cn';
        sub_filter 'newssc.org' 'newssc.org.ext.cditv.cn';
        sub_filter 'nnwb.com' 'nnwb.com.ext.cditv.cn';
        sub_filter 'nonobtrusive.com' 'nonobtrusive.com.ext.cditv.cn';
        sub_filter 'ntce.cn' 'ntce.cn.ext.cditv.cn';
        sub_filter 'nwbox.com' 'nwbox.com.ext.cditv.cn';
        sub_filter 'opensource.org' 'opensource.org.ext.cditv.cn';
        sub_filter 'org.cn' 'org.cn.ext.cditv.cn';
        sub_filter 'pptv.com' 'pptv.com.ext.cditv.cn';
        sub_filter 'qingdaonews.com' 'qingdaonews.com.ext.cditv.cn';
        sub_filter 'qlogo.cn' 'qlogo.cn.ext.cditv.cn';
        sub_filter 'qpic.cn' 'qpic.cn.ext.cditv.cn';
        sub_filter 'qq.com' 'qq.com.ext.cditv.cn';
        sub_filter 'rednet.cn' 'rednet.cn.ext.cditv.cn';
        sub_filter 'renren.com' 'renren.com.ext.cditv.cn';
        sub_filter 'requirejs.org' 'requirejs.org.ext.cditv.cn';
        sub_filter 'ricostacruz.com' 'ricostacruz.com.ext.cditv.cn';
        sub_filter 'runsky.com' 'runsky.com.ext.cditv.cn';
        sub_filter 'scdaily.cn' 'scdaily.cn.ext.cditv.cn';
        sub_filter 'scdytv.com' 'scdytv.com.ext.cditv.cn';
        sub_filter 'scedu.net' 'scedu.net.ext.cditv.cn';
        sub_filter 'sceea.cn' 'sceea.cn.ext.cditv.cn';
        sub_filter 'scjtcx.cn' 'scjtcx.cn.ext.cditv.cn';
        sub_filter 'scqckypw.com' 'scqckypw.com.ext.cditv.cn';
        sub_filter 'scqcp.com' 'scqcp.com.ext.cditv.cn';
        sub_filter 'sczytv.com' 'sczytv.com.ext.cditv.cn';
        sub_filter 'sinaimg.cn' 'sinaimg.cn.ext.cditv.cn';
        sub_filter 'sinajs.cn' 'sinajs.cn.ext.cditv.cn';
        sub_filter 'sitepoint.com' 'sitepoint.com.ext.cditv.cn';
        sub_filter 'sizzlejs.com' 'sizzlejs.com.ext.cditv.cn';
        sub_filter 'smweekly.com' 'smweekly.com.ext.cditv.cn';
        sub_filter 'sohu.com' 'sohu.com.ext.cditv.cn';
        sub_filter 'stackoverflow.com' 'stackoverflow.com.ext.cditv.cn';
        sub_filter 'steamdev.com' 'steamdev.com.ext.cditv.cn';
        sub_filter 'studygoldcoast.cn' 'studygoldcoast.cn.ext.cditv.cn';
        sub_filter 'sxlawyer.org' 'sxlawyer.org.ext.cditv.cn';
        sub_filter 't.cn' 't.cn.ext.cditv.cn';
        sub_filter 'thepaper.cn' 'thepaper.cn.ext.cditv.cn';
        sub_filter 'toptour.cn' 'toptour.cn.ext.cditv.cn';
        sub_filter 'ts.cn' 'ts.cn.ext.cditv.cn';
        sub_filter 'tsichuan.com' 'tsichuan.com.ext.cditv.cn';
        sub_filter 'voiceofgame.com' 'voiceofgame.com.ext.cditv.cn';
        sub_filter 'weibo.com' 'weibo.com.ext.cditv.cn';
        sub_filter 'weiphone.com' 'weiphone.com.ext.cditv.cn';
        sub_filter 'wenjuan.com' 'wenjuan.com.ext.cditv.cn';
        sub_filter 'wenming.cn' 'wenming.cn.ext.cditv.cn';
        sub_filter 'wikipedia.org' 'wikipedia.org.ext.cditv.cn';
        sub_filter 'workercn.cn' 'workercn.cn.ext.cditv.cn';
        sub_filter 'xbgysjz.com' 'xbgysjz.com.ext.cditv.cn';
        sub_filter 'xiancn.com' 'xiancn.com.ext.cditv.cn';
        sub_filter 'xinhuanet.com' 'xinhuanet.com.ext.cditv.cn';
        sub_filter 'xiumi.us' 'xiumi.us.ext.cditv.cn';
        sub_filter 'xxsb.com' 'xxsb.com.ext.cditv.cn';
        sub_filter 'yangtse.com' 'yangtse.com.ext.cditv.cn';
        sub_filter 'ybtv.cc' 'ybtv.cc.ext.cditv.cn';
        sub_filter 'ycwb.com' 'ycwb.com.ext.cditv.cn';
        sub_filter 'ykimg.com' 'ykimg.com.ext.cditv.cn';
        sub_filter 'ynet.com' 'ynet.com.ext.cditv.cn';
        sub_filter 'youku.com' 'youku.com.ext.cditv.cn';
        sub_filter 'youth.cn' 'youth.cn.ext.cditv.cn';
        sub_filter 'yunnan.cn' 'yunnan.cn.ext.cditv.cn';
        sub_filter 'yzwb.net' 'yzwb.net.ext.cditv.cn';
        sub_filter 'zgbctv.com' 'zgbctv.com.ext.cditv.cn';
        sub_filter 'zhaopin.com' 'zhaopin.com.ext.cditv.cn';
        sub_filter 'zhishanjijin.cn' 'zhishanjijin.cn.ext.cditv.cn';
        sub_filter 'zhongguowangshi.com:8091' 'zhongguowangshi.com.8091.pext.cditv.cn';
        sub_filter 'zhubajie.com' 'zhubajie.com.ext.cditv.cn';
        sub_filter 'zynews.com' 'zynews.com.ext.cditv.cn';
    }
}

server {
    listen [::]:80;

    server_name ~^(?P<ext_domain>.*).ext.cditv.cn$;

    location / {
        resolver 223.5.5.5 ipv6=off;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Accept-Encoding "";
        proxy_redirect ~^http://([^/]*)/(.*)$ http://$1.ext.cditv.cn/$2;
        proxy_set_header Host $ext_domain;
        proxy_pass http://$ext_domain/$request_uri;

        sub_filter_last_modified on;
        sub_filter_once off;
        sub_filter_types text/css text/javascript application/javascript; #text/html is always included
        sub_filter '182.148.112.25:8080' '182.148.112.25.8080.pext.cditv.cn';
        sub_filter '218.89.164.17:7980' '218.89.164.17.7980.pext.cditv.cn';
        sub_filter '222.211.87.210:8080' '222.211.87.210.8080.pext.cditv.cn';
        sub_filter 'abbao.cn' 'abbao.cn.ext.cditv.cn';
        sub_filter 'adobe.com' 'adobe.com.ext.cditv.cn';
        sub_filter 'adomas.org' 'adomas.org.ext.cditv.cn';
        sub_filter 'alicdn.com' 'alicdn.com.ext.cditv.cn';
        sub_filter 'apache.org' 'apache.org.ext.cditv.cn';
        sub_filter 'apple.com' 'apple.com.ext.cditv.cn';
        sub_filter 'areaaperta.com' 'areaaperta.com.ext.cditv.cn';
        sub_filter 'baidu.com' 'baidu.com.ext.cditv.cn';
        sub_filter 'bootcss.com' 'bootcss.com.ext.cditv.cn';
        sub_filter 'bzgd.com' 'bzgd.com.ext.cditv.cn';
        sub_filter 'cctvpic.com' 'cctvpic.com.ext.cditv.cn';
        sub_filter 'cdcaa.net' 'cdcaa.net.ext.cditv.cn';
        sub_filter 'cdcaf.com' 'cdcaf.com.ext.cditv.cn';
        sub_filter 'cdcdw.org' 'cdcdw.org.ext.cditv.cn';
        sub_filter 'cddzgj.com:8189' 'cddzgj.com.8189.pext.cditv.cn';
        sub_filter 'cdhxzx.cn' 'cdhxzx.cn.ext.cditv.cn';
        sub_filter 'cdich.org' 'cdich.org.ext.cditv.cn';
        sub_filter 'cdimae.com' 'cdimae.com.ext.cditv.cn';
        sub_filter 'cdmetro.cn' 'cdmetro.cn.ext.cditv.cn';
        sub_filter 'cdsmes.com:8081' 'cdsmes.com.8081.pext.cditv.cn';
        sub_filter 'cdtv.cn' 'cdtv.cn.ext.cditv.cn';
        sub_filter 'cdtzjc.com' 'cdtzjc.com.ext.cditv.cn';
        sub_filter 'cdvolunteer.com' 'cdvolunteer.com.ext.cditv.cn';
        sub_filter 'cdzk.com' 'cdzk.com.ext.cditv.cn';
        sub_filter 'cdzk.net' 'cdzk.net.ext.cditv.cn';
        sub_filter 'cdzk.org' 'cdzk.org.ext.cditv.cn';
        sub_filter 'ce.cn' 'ce.cn.ext.cditv.cn';
        sub_filter 'ceweekly.cn' 'ceweekly.cn.ext.cditv.cn';
        sub_filter 'chengdu.cn' 'chengdu.cn.ext.cditv.cn';
        sub_filter 'chengdutv.com' 'chengdutv.com.ext.cditv.cn';
        sub_filter 'china.cn' 'china.cn.ext.cditv.cn';
        sub_filter 'chinanews.com' 'chinanews.com.ext.cditv.cn';
        sub_filter 'ciavc.com' 'ciavc.com.ext.cditv.cn';
        sub_filter 'cjn.cn' 'cjn.cn.ext.cditv.cn';
        sub_filter 'cntv.cn' 'cntv.cn.ext.cditv.cn';
        sub_filter 'com.cn' 'com.cn.ext.cditv.cn';
        sub_filter 'co.uk' 'co.uk.ext.cditv.cn';
        sub_filter 'cqcb.com' 'cqcb.com.ext.cditv.cn';
        sub_filter 'cqtimes.cn' 'cqtimes.cn.ext.cditv.cn';
        sub_filter 'creativecommons.org' 'creativecommons.org.ext.cditv.cn';
        sub_filter 'cri.cn' 'cri.cn.ext.cditv.cn';
        sub_filter 'csjmpd.com' 'csjmpd.com.ext.cditv.cn';
        sub_filter 'cssglobe.com' 'cssglobe.com.ext.cditv.cn';
        sub_filter 'cubiq.org' 'cubiq.org.ext.cditv.cn';
        sub_filter 'cyol.com' 'cyol.com.ext.cditv.cn';
        sub_filter 'dahe.cn' 'dahe.cn.ext.cditv.cn';
        sub_filter 'damai.cn' 'damai.cn.ext.cditv.cn';
        sub_filter 'dayoo.com' 'dayoo.com.ext.cditv.cn';
        sub_filter 'derraab.com' 'derraab.com.ext.cditv.cn';
        sub_filter 'douban.com' 'douban.com.ext.cditv.cn';
        sub_filter 'edu.cn' 'edu.cn.ext.cditv.cn';
        sub_filter 'edufair.org' 'edufair.org.ext.cditv.cn';
        sub_filter 'eqxiu.com' 'eqxiu.com.ext.cditv.cn';
        sub_filter 'europa.eu' 'europa.eu.ext.cditv.cn';
        sub_filter 'game.com' 'game.com.ext.cditv.cn';
        sub_filter 'gblock.cn' 'gblock.cn.ext.cditv.cn';
        sub_filter 'github.com' 'github.com.ext.cditv.cn';
        sub_filter 'gmgc.info' 'gmgc.info.ext.cditv.cn';
        sub_filter 'gmgdc.com' 'gmgdc.com.ext.cditv.cn';
        sub_filter 'gnu.org' 'gnu.org.ext.cditv.cn';
        sub_filter 'google.cn' 'google.cn.ext.cditv.cn';
        sub_filter 'google.com' 'google.com.ext.cditv.cn';
        sub_filter 'gov.cn' 'gov.cn.ext.cditv.cn';
        sub_filter 'gov.cn:9080' 'gov.cn.9080.pext.cditv.cn';
        sub_filter 'gov.il' 'gov.il.ext.cditv.cn';
        sub_filter 'gridsum.com' 'gridsum.com.ext.cditv.cn';
        sub_filter 'gridsumdissector.cn' 'gridsumdissector.cn.ext.cditv.cn';
        sub_filter 'gridsumdissector.com' 'gridsumdissector.com.ext.cditv.cn';
        sub_filter 'hsw.cn' 'hsw.cn.ext.cditv.cn';
        sub_filter 'huanqiu.com' 'huanqiu.com.ext.cditv.cn';
        sub_filter 'huatu.com' 'huatu.com.ext.cditv.cn';
        sub_filter 'hurun.net' 'hurun.net.ext.cditv.cn';
        sub_filter 'hxsc.org' 'hxsc.org.ext.cditv.cn';
        sub_filter 'idangero.us' 'idangero.us.ext.cditv.cn';
        sub_filter 'ifeng.com' 'ifeng.com.ext.cditv.cn';
        sub_filter 'ifengimg.com' 'ifengimg.com.ext.cditv.cn';
        sub_filter 'indiegamr.com' 'indiegamr.com.ext.cditv.cn';
        sub_filter 'jd.com' 'jd.com.ext.cditv.cn';
        sub_filter 'jfdaily.com' 'jfdaily.com.ext.cditv.cn';
        sub_filter 'jiblock.cn' 'jiblock.cn.ext.cditv.cn';
        sub_filter 'jinbaonet.com' 'jinbaonet.com.ext.cditv.cn';
        sub_filter 'jinghua.cn' 'jinghua.cn.ext.cditv.cn';
        sub_filter 'jquery.com' 'jquery.com.ext.cditv.cn';
        sub_filter 'jquery.org' 'jquery.org.ext.cditv.cn';
        sub_filter 'letv.com' 'letv.com.ext.cditv.cn';
        sub_filter 'lfnrtv.com' 'lfnrtv.com.ext.cditv.cn';
        sub_filter 'libo.ml' 'libo.ml.ext.cditv.cn';
        sub_filter 'lokeshdhakar.com' 'lokeshdhakar.com.ext.cditv.cn';
        sub_filter 'macromedia.com' 'macromedia.com.ext.cditv.cn';
        sub_filter 'mil.cn' 'mil.cn.ext.cditv.cn';
        sub_filter 'mozilla.org' 'mozilla.org.ext.cditv.cn';
        sub_filter 'mtime.com' 'mtime.com.ext.cditv.cn';
        sub_filter 'nandu.com' 'nandu.com.ext.cditv.cn';
        sub_filter 'ncss.cn' 'ncss.cn.ext.cditv.cn';
        sub_filter 'news.cn' 'news.cn.ext.cditv.cn';
        sub_filter 'newssc.org' 'newssc.org.ext.cditv.cn';
        sub_filter 'nnwb.com' 'nnwb.com.ext.cditv.cn';
        sub_filter 'nonobtrusive.com' 'nonobtrusive.com.ext.cditv.cn';
        sub_filter 'ntce.cn' 'ntce.cn.ext.cditv.cn';
        sub_filter 'nwbox.com' 'nwbox.com.ext.cditv.cn';
        sub_filter 'opensource.org' 'opensource.org.ext.cditv.cn';
        sub_filter 'org.cn' 'org.cn.ext.cditv.cn';
        sub_filter 'pptv.com' 'pptv.com.ext.cditv.cn';
        sub_filter 'qingdaonews.com' 'qingdaonews.com.ext.cditv.cn';
        sub_filter 'qlogo.cn' 'qlogo.cn.ext.cditv.cn';
        sub_filter 'qpic.cn' 'qpic.cn.ext.cditv.cn';
        sub_filter 'qq.com' 'qq.com.ext.cditv.cn';
        sub_filter 'rednet.cn' 'rednet.cn.ext.cditv.cn';
        sub_filter 'renren.com' 'renren.com.ext.cditv.cn';
        sub_filter 'requirejs.org' 'requirejs.org.ext.cditv.cn';
        sub_filter 'ricostacruz.com' 'ricostacruz.com.ext.cditv.cn';
        sub_filter 'runsky.com' 'runsky.com.ext.cditv.cn';
        sub_filter 'scdaily.cn' 'scdaily.cn.ext.cditv.cn';
        sub_filter 'scdytv.com' 'scdytv.com.ext.cditv.cn';
        sub_filter 'scedu.net' 'scedu.net.ext.cditv.cn';
        sub_filter 'sceea.cn' 'sceea.cn.ext.cditv.cn';
        sub_filter 'scjtcx.cn' 'scjtcx.cn.ext.cditv.cn';
        sub_filter 'scqckypw.com' 'scqckypw.com.ext.cditv.cn';
        sub_filter 'scqcp.com' 'scqcp.com.ext.cditv.cn';
        sub_filter 'sczytv.com' 'sczytv.com.ext.cditv.cn';
        sub_filter 'sinaimg.cn' 'sinaimg.cn.ext.cditv.cn';
        sub_filter 'sinajs.cn' 'sinajs.cn.ext.cditv.cn';
        sub_filter 'sitepoint.com' 'sitepoint.com.ext.cditv.cn';
        sub_filter 'sizzlejs.com' 'sizzlejs.com.ext.cditv.cn';
        sub_filter 'smweekly.com' 'smweekly.com.ext.cditv.cn';
        sub_filter 'sohu.com' 'sohu.com.ext.cditv.cn';
        sub_filter 'stackoverflow.com' 'stackoverflow.com.ext.cditv.cn';
        sub_filter 'steamdev.com' 'steamdev.com.ext.cditv.cn';
        sub_filter 'studygoldcoast.cn' 'studygoldcoast.cn.ext.cditv.cn';
        sub_filter 'sxlawyer.org' 'sxlawyer.org.ext.cditv.cn';
        sub_filter 't.cn' 't.cn.ext.cditv.cn';
        sub_filter 'thepaper.cn' 'thepaper.cn.ext.cditv.cn';
        sub_filter 'toptour.cn' 'toptour.cn.ext.cditv.cn';
        sub_filter 'ts.cn' 'ts.cn.ext.cditv.cn';
        sub_filter 'tsichuan.com' 'tsichuan.com.ext.cditv.cn';
        sub_filter 'voiceofgame.com' 'voiceofgame.com.ext.cditv.cn';
        sub_filter 'weibo.com' 'weibo.com.ext.cditv.cn';
        sub_filter 'weiphone.com' 'weiphone.com.ext.cditv.cn';
        sub_filter 'wenjuan.com' 'wenjuan.com.ext.cditv.cn';
        sub_filter 'wenming.cn' 'wenming.cn.ext.cditv.cn';
        sub_filter 'wikipedia.org' 'wikipedia.org.ext.cditv.cn';
        sub_filter 'workercn.cn' 'workercn.cn.ext.cditv.cn';
        sub_filter 'xbgysjz.com' 'xbgysjz.com.ext.cditv.cn';
        sub_filter 'xiancn.com' 'xiancn.com.ext.cditv.cn';
        sub_filter 'xinhuanet.com' 'xinhuanet.com.ext.cditv.cn';
        sub_filter 'xiumi.us' 'xiumi.us.ext.cditv.cn';
        sub_filter 'xxsb.com' 'xxsb.com.ext.cditv.cn';
        sub_filter 'yangtse.com' 'yangtse.com.ext.cditv.cn';
        sub_filter 'ybtv.cc' 'ybtv.cc.ext.cditv.cn';
        sub_filter 'ycwb.com' 'ycwb.com.ext.cditv.cn';
        sub_filter 'ykimg.com' 'ykimg.com.ext.cditv.cn';
        sub_filter 'ynet.com' 'ynet.com.ext.cditv.cn';
        sub_filter 'youku.com' 'youku.com.ext.cditv.cn';
        sub_filter 'youth.cn' 'youth.cn.ext.cditv.cn';
        sub_filter 'yunnan.cn' 'yunnan.cn.ext.cditv.cn';
        sub_filter 'yzwb.net' 'yzwb.net.ext.cditv.cn';
        sub_filter 'zgbctv.com' 'zgbctv.com.ext.cditv.cn';
        sub_filter 'zhaopin.com' 'zhaopin.com.ext.cditv.cn';
        sub_filter 'zhishanjijin.cn' 'zhishanjijin.cn.ext.cditv.cn';
        sub_filter 'zhongguowangshi.com:8091' 'zhongguowangshi.com.8091.pext.cditv.cn';
        sub_filter 'zhubajie.com' 'zhubajie.com.ext.cditv.cn';
        sub_filter 'zynews.com' 'zynews.com.ext.cditv.cn';
    }
}

server {
    listen [::]:80;

    server_name ~^([^./@]*\.)*cditv\.(cn|tv)$;

    location / {
        resolver 223.5.5.5 ipv6=off;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Accept-Encoding "";
        proxy_redirect ~^http://([^/]*)/(.*)$ http://$1.ext.cditv.cn/$2;
        proxy_set_header Host $host;
        proxy_pass http://$host$request_uri;

        sub_filter_last_modified on;
        sub_filter_once off;
        sub_filter_types text/css text/javascript application/javascript; #text/html is always included
        sub_filter '182.148.112.25:8080' '182.148.112.25.8080.pext.cditv.cn';
        sub_filter '218.89.164.17:7980' '218.89.164.17.7980.pext.cditv.cn';
        sub_filter '222.211.87.210:8080' '222.211.87.210.8080.pext.cditv.cn';
        sub_filter 'abbao.cn' 'abbao.cn.ext.cditv.cn';
        sub_filter 'adobe.com' 'adobe.com.ext.cditv.cn';
        sub_filter 'adomas.org' 'adomas.org.ext.cditv.cn';
        sub_filter 'alicdn.com' 'alicdn.com.ext.cditv.cn';
        sub_filter 'apache.org' 'apache.org.ext.cditv.cn';
        sub_filter 'apple.com' 'apple.com.ext.cditv.cn';
        sub_filter 'areaaperta.com' 'areaaperta.com.ext.cditv.cn';
        sub_filter 'baidu.com' 'baidu.com.ext.cditv.cn';
        sub_filter 'bootcss.com' 'bootcss.com.ext.cditv.cn';
        sub_filter 'bzgd.com' 'bzgd.com.ext.cditv.cn';
        sub_filter 'cctvpic.com' 'cctvpic.com.ext.cditv.cn';
        sub_filter 'cdcaa.net' 'cdcaa.net.ext.cditv.cn';
        sub_filter 'cdcaf.com' 'cdcaf.com.ext.cditv.cn';
        sub_filter 'cdcdw.org' 'cdcdw.org.ext.cditv.cn';
        sub_filter 'cddzgj.com:8189' 'cddzgj.com.8189.pext.cditv.cn';
        sub_filter 'cdhxzx.cn' 'cdhxzx.cn.ext.cditv.cn';
        sub_filter 'cdich.org' 'cdich.org.ext.cditv.cn';
        sub_filter 'cdimae.com' 'cdimae.com.ext.cditv.cn';
        sub_filter 'cdmetro.cn' 'cdmetro.cn.ext.cditv.cn';
        sub_filter 'cdsmes.com:8081' 'cdsmes.com.8081.pext.cditv.cn';
        sub_filter 'cdtv.cn' 'cdtv.cn.ext.cditv.cn';
        sub_filter 'cdtzjc.com' 'cdtzjc.com.ext.cditv.cn';
        sub_filter 'cdvolunteer.com' 'cdvolunteer.com.ext.cditv.cn';
        sub_filter 'cdzk.com' 'cdzk.com.ext.cditv.cn';
        sub_filter 'cdzk.net' 'cdzk.net.ext.cditv.cn';
        sub_filter 'cdzk.org' 'cdzk.org.ext.cditv.cn';
        sub_filter 'ce.cn' 'ce.cn.ext.cditv.cn';
        sub_filter 'ceweekly.cn' 'ceweekly.cn.ext.cditv.cn';
        sub_filter 'chengdu.cn' 'chengdu.cn.ext.cditv.cn';
        sub_filter 'chengdutv.com' 'chengdutv.com.ext.cditv.cn';
        sub_filter 'china.cn' 'china.cn.ext.cditv.cn';
        sub_filter 'chinanews.com' 'chinanews.com.ext.cditv.cn';
        sub_filter 'ciavc.com' 'ciavc.com.ext.cditv.cn';
        sub_filter 'cjn.cn' 'cjn.cn.ext.cditv.cn';
        sub_filter 'cntv.cn' 'cntv.cn.ext.cditv.cn';
        sub_filter 'com.cn' 'com.cn.ext.cditv.cn';
        sub_filter 'co.uk' 'co.uk.ext.cditv.cn';
        sub_filter 'cqcb.com' 'cqcb.com.ext.cditv.cn';
        sub_filter 'cqtimes.cn' 'cqtimes.cn.ext.cditv.cn';
        sub_filter 'creativecommons.org' 'creativecommons.org.ext.cditv.cn';
        sub_filter 'cri.cn' 'cri.cn.ext.cditv.cn';
        sub_filter 'csjmpd.com' 'csjmpd.com.ext.cditv.cn';
        sub_filter 'cssglobe.com' 'cssglobe.com.ext.cditv.cn';
        sub_filter 'cubiq.org' 'cubiq.org.ext.cditv.cn';
        sub_filter 'cyol.com' 'cyol.com.ext.cditv.cn';
        sub_filter 'dahe.cn' 'dahe.cn.ext.cditv.cn';
        sub_filter 'damai.cn' 'damai.cn.ext.cditv.cn';
        sub_filter 'dayoo.com' 'dayoo.com.ext.cditv.cn';
        sub_filter 'derraab.com' 'derraab.com.ext.cditv.cn';
        sub_filter 'douban.com' 'douban.com.ext.cditv.cn';
        sub_filter 'edu.cn' 'edu.cn.ext.cditv.cn';
        sub_filter 'edufair.org' 'edufair.org.ext.cditv.cn';
        sub_filter 'eqxiu.com' 'eqxiu.com.ext.cditv.cn';
        sub_filter 'europa.eu' 'europa.eu.ext.cditv.cn';
        sub_filter 'game.com' 'game.com.ext.cditv.cn';
        sub_filter 'gblock.cn' 'gblock.cn.ext.cditv.cn';
        sub_filter 'github.com' 'github.com.ext.cditv.cn';
        sub_filter 'gmgc.info' 'gmgc.info.ext.cditv.cn';
        sub_filter 'gmgdc.com' 'gmgdc.com.ext.cditv.cn';
        sub_filter 'gnu.org' 'gnu.org.ext.cditv.cn';
        sub_filter 'google.cn' 'google.cn.ext.cditv.cn';
        sub_filter 'google.com' 'google.com.ext.cditv.cn';
        sub_filter 'gov.cn' 'gov.cn.ext.cditv.cn';
        sub_filter 'gov.cn:9080' 'gov.cn.9080.pext.cditv.cn';
        sub_filter 'gov.il' 'gov.il.ext.cditv.cn';
        sub_filter 'gridsum.com' 'gridsum.com.ext.cditv.cn';
        sub_filter 'gridsumdissector.cn' 'gridsumdissector.cn.ext.cditv.cn';
        sub_filter 'gridsumdissector.com' 'gridsumdissector.com.ext.cditv.cn';
        sub_filter 'hsw.cn' 'hsw.cn.ext.cditv.cn';
        sub_filter 'huanqiu.com' 'huanqiu.com.ext.cditv.cn';
        sub_filter 'huatu.com' 'huatu.com.ext.cditv.cn';
        sub_filter 'hurun.net' 'hurun.net.ext.cditv.cn';
        sub_filter 'hxsc.org' 'hxsc.org.ext.cditv.cn';
        sub_filter 'idangero.us' 'idangero.us.ext.cditv.cn';
        sub_filter 'ifeng.com' 'ifeng.com.ext.cditv.cn';
        sub_filter 'ifengimg.com' 'ifengimg.com.ext.cditv.cn';
        sub_filter 'indiegamr.com' 'indiegamr.com.ext.cditv.cn';
        sub_filter 'jd.com' 'jd.com.ext.cditv.cn';
        sub_filter 'jfdaily.com' 'jfdaily.com.ext.cditv.cn';
        sub_filter 'jiblock.cn' 'jiblock.cn.ext.cditv.cn';
        sub_filter 'jinbaonet.com' 'jinbaonet.com.ext.cditv.cn';
        sub_filter 'jinghua.cn' 'jinghua.cn.ext.cditv.cn';
        sub_filter 'jquery.com' 'jquery.com.ext.cditv.cn';
        sub_filter 'jquery.org' 'jquery.org.ext.cditv.cn';
        sub_filter 'letv.com' 'letv.com.ext.cditv.cn';
        sub_filter 'lfnrtv.com' 'lfnrtv.com.ext.cditv.cn';
        sub_filter 'libo.ml' 'libo.ml.ext.cditv.cn';
        sub_filter 'lokeshdhakar.com' 'lokeshdhakar.com.ext.cditv.cn';
        sub_filter 'macromedia.com' 'macromedia.com.ext.cditv.cn';
        sub_filter 'mil.cn' 'mil.cn.ext.cditv.cn';
        sub_filter 'mozilla.org' 'mozilla.org.ext.cditv.cn';
        sub_filter 'mtime.com' 'mtime.com.ext.cditv.cn';
        sub_filter 'nandu.com' 'nandu.com.ext.cditv.cn';
        sub_filter 'ncss.cn' 'ncss.cn.ext.cditv.cn';
        sub_filter 'news.cn' 'news.cn.ext.cditv.cn';
        sub_filter 'newssc.org' 'newssc.org.ext.cditv.cn';
        sub_filter 'nnwb.com' 'nnwb.com.ext.cditv.cn';
        sub_filter 'nonobtrusive.com' 'nonobtrusive.com.ext.cditv.cn';
        sub_filter 'ntce.cn' 'ntce.cn.ext.cditv.cn';
        sub_filter 'nwbox.com' 'nwbox.com.ext.cditv.cn';
        sub_filter 'opensource.org' 'opensource.org.ext.cditv.cn';
        sub_filter 'org.cn' 'org.cn.ext.cditv.cn';
        sub_filter 'pptv.com' 'pptv.com.ext.cditv.cn';
        sub_filter 'qingdaonews.com' 'qingdaonews.com.ext.cditv.cn';
        sub_filter 'qlogo.cn' 'qlogo.cn.ext.cditv.cn';
        sub_filter 'qpic.cn' 'qpic.cn.ext.cditv.cn';
        sub_filter 'qq.com' 'qq.com.ext.cditv.cn';
        sub_filter 'rednet.cn' 'rednet.cn.ext.cditv.cn';
        sub_filter 'renren.com' 'renren.com.ext.cditv.cn';
        sub_filter 'requirejs.org' 'requirejs.org.ext.cditv.cn';
        sub_filter 'ricostacruz.com' 'ricostacruz.com.ext.cditv.cn';
        sub_filter 'runsky.com' 'runsky.com.ext.cditv.cn';
        sub_filter 'scdaily.cn' 'scdaily.cn.ext.cditv.cn';
        sub_filter 'scdytv.com' 'scdytv.com.ext.cditv.cn';
        sub_filter 'scedu.net' 'scedu.net.ext.cditv.cn';
        sub_filter 'sceea.cn' 'sceea.cn.ext.cditv.cn';
        sub_filter 'scjtcx.cn' 'scjtcx.cn.ext.cditv.cn';
        sub_filter 'scqckypw.com' 'scqckypw.com.ext.cditv.cn';
        sub_filter 'scqcp.com' 'scqcp.com.ext.cditv.cn';
        sub_filter 'sczytv.com' 'sczytv.com.ext.cditv.cn';
        sub_filter 'sinaimg.cn' 'sinaimg.cn.ext.cditv.cn';
        sub_filter 'sinajs.cn' 'sinajs.cn.ext.cditv.cn';
        sub_filter 'sitepoint.com' 'sitepoint.com.ext.cditv.cn';
        sub_filter 'sizzlejs.com' 'sizzlejs.com.ext.cditv.cn';
        sub_filter 'smweekly.com' 'smweekly.com.ext.cditv.cn';
        sub_filter 'sohu.com' 'sohu.com.ext.cditv.cn';
        sub_filter 'stackoverflow.com' 'stackoverflow.com.ext.cditv.cn';
        sub_filter 'steamdev.com' 'steamdev.com.ext.cditv.cn';
        sub_filter 'studygoldcoast.cn' 'studygoldcoast.cn.ext.cditv.cn';
        sub_filter 'sxlawyer.org' 'sxlawyer.org.ext.cditv.cn';
        sub_filter 't.cn' 't.cn.ext.cditv.cn';
        sub_filter 'thepaper.cn' 'thepaper.cn.ext.cditv.cn';
        sub_filter 'toptour.cn' 'toptour.cn.ext.cditv.cn';
        sub_filter 'ts.cn' 'ts.cn.ext.cditv.cn';
        sub_filter 'tsichuan.com' 'tsichuan.com.ext.cditv.cn';
        sub_filter 'voiceofgame.com' 'voiceofgame.com.ext.cditv.cn';
        sub_filter 'weibo.com' 'weibo.com.ext.cditv.cn';
        sub_filter 'weiphone.com' 'weiphone.com.ext.cditv.cn';
        sub_filter 'wenjuan.com' 'wenjuan.com.ext.cditv.cn';
        sub_filter 'wenming.cn' 'wenming.cn.ext.cditv.cn';
        sub_filter 'wikipedia.org' 'wikipedia.org.ext.cditv.cn';
        sub_filter 'workercn.cn' 'workercn.cn.ext.cditv.cn';
        sub_filter 'xbgysjz.com' 'xbgysjz.com.ext.cditv.cn';
        sub_filter 'xiancn.com' 'xiancn.com.ext.cditv.cn';
        sub_filter 'xinhuanet.com' 'xinhuanet.com.ext.cditv.cn';
        sub_filter 'xiumi.us' 'xiumi.us.ext.cditv.cn';
        sub_filter 'xxsb.com' 'xxsb.com.ext.cditv.cn';
        sub_filter 'yangtse.com' 'yangtse.com.ext.cditv.cn';
        sub_filter 'ybtv.cc' 'ybtv.cc.ext.cditv.cn';
        sub_filter 'ycwb.com' 'ycwb.com.ext.cditv.cn';
        sub_filter 'ykimg.com' 'ykimg.com.ext.cditv.cn';
        sub_filter 'ynet.com' 'ynet.com.ext.cditv.cn';
        sub_filter 'youku.com' 'youku.com.ext.cditv.cn';
        sub_filter 'youth.cn' 'youth.cn.ext.cditv.cn';
        sub_filter 'yunnan.cn' 'yunnan.cn.ext.cditv.cn';
        sub_filter 'yzwb.net' 'yzwb.net.ext.cditv.cn';
        sub_filter 'zgbctv.com' 'zgbctv.com.ext.cditv.cn';
        sub_filter 'zhaopin.com' 'zhaopin.com.ext.cditv.cn';
        sub_filter 'zhishanjijin.cn' 'zhishanjijin.cn.ext.cditv.cn';
        sub_filter 'zhongguowangshi.com:8091' 'zhongguowangshi.com.8091.pext.cditv.cn';
        sub_filter 'zhubajie.com' 'zhubajie.com.ext.cditv.cn';
        sub_filter 'zynews.com' 'zynews.com.ext.cditv.cn';
    }
}
